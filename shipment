CREATE DATABASE Shipment;

use Shipment;

-- Creating Table Customer.
CREATE TABLE CUSTOMER(
customer_id INT PRIMARY KEY,
name VARCHAR(30),
city VARCHAR(25));

-- Creating Table Order
CREATE TABLE order_info(
order_id INT PRIMARY KEY,
order_date DATE,
cust_id INT,
order_amount INT,
FOREIGN KEY (cust_id) REFERENCES CUSTOMER(customer_id) ON DELETE SET NULL);

-- Creating Item Table
CREATE TABLE ITEM(
item_id INT PRIMARY KEY,
unit_price INT);


-- Creating Table Order item
CREATE TABLE order_item(
o_id INT,
itm_id INT ,
quantity INT,
FOREIGN KEY (o_id) REFERENCES order_info(order_id) ON DELETE SET NULL,
FOREIGN KEY (itm_id) REFERENCES ITEM(item_id) ON DELETE SET NULL);

-- Creating Table Warehouse 
CREATE TABLE Warehouse(
warehouse_id INT PRIMARY KEY,
city VARCHAR(30) );

-- Creating Table Shipment
CREATE TABLE Shipment(
ord_id INT ,
whouse_id INT,
ship_date DATE,
FOREIGN KEY (ord_id) REFERENCES order_info(order_id) ON DELETE SET NULL,
FOREIGN KEY (whouse_id) REFERENCES Warehouse(warehouse_id) ON DELETE SET NULL);

-- Inserting Values into Customer Table
INSERT INTO CUSTOMER
(customer_id,name,city)
VALUES
(145,"Rancho","Leh"),
(269,"Chatur","Delhi"),
(391,"Srikant Tiwari","Pune"),
(426,"Jay Shah","Gandhinagar"),
(551,"Ismail Khadri","Banglore");

SELECT * FROM CUSTOMER;

-- Inserting into Order table
INSERT INTO order_info
(order_id,order_date,cust_id,order_amount)
VALUES
(114026,"2023-10-08",145,10000),
(113025,"2023-10-10",269,5000),
(124501,"2023-10-09",391,7500),
(192731,"2023-10-14",426,15000),
(236172,"2023-10-17",551,8000);

SELECT * FROM order_info;

-- Inserting into item table
INSERT INTO ITEM
(item_id,unit_price)
VALUES
(121,1000),
(282,200),
(343,750),
(404,15000),
(525,400);

SELECT * FROM ITEM;

-- Inserting into order item table
INSERT INTO order_item
(o_id,itm_id,quantity)
VALUES
(114026,121,10),
(113025,282,25),
(124501,343,10),
(192731,404,1),
(236172,525,20);

SELECT * FROM order_item;

-- Inserting data shipment table
INSERT INTO Warehouse
(warehouse_id,city)
VALUES
(1,"Delhi"),
(2,"Banglore"),
(3,"Chennai"),
(4,"Ahmedabad"),
(5,"Kolkata");

SELECT * FROM Warehouse;


-- Inserting data into the Shipment table
INSERT INTO Shipment (ord_id, whouse_id, ship_date)
VALUES
(114026, 1, "2023-10-09"),
(113025, 5, "2023-10-11"),
(124501, 2, "2023-10-10"),
(192731, 4, "2023-10-15"),
(236172, 3, "2023-10-18");

SELECT * FROM SHIPMENT;

-- Adding the pincode in the customer table
ALTER TABLE CUSTOMER
ADD COLUMN pincode VARCHAR(10);

-- Inserting pincode into Customer
UPDATE CUSTOMER
SET pincode="194101"
WHERE pincode IS NULL and name="Rancho";

UPDATE CUSTOMER
SET pincode="110001"
WHERE pincode IS NULL and name="Chatur";

UPDATE CUSTOMER
SET pincode="410014"
WHERE pincode IS NULL and name="Srikant Tiwari";

UPDATE CUSTOMER
SET pincode="382002"
WHERE pincode IS NULL and name="Jay Shah";

UPDATE CUSTOMER
SET pincode="560002"
WHERE pincode IS NULL and name="Ismail Khadri";

-- Adding shipping charges column
ALTER TABLE order_info
ADD COLUMN shipping_charges INT;

-- Updating Shipping charges
UPDATE order_info
SET shipping_charges=0;

-- Adding item_name coulmn
ALTER TABLE ITEM
ADD COLUMN item_name VARCHAR(30);

-- Updating values for item table
UPDATE ITEM
SET item_name="Gaming Headphones"
WHERE item_id=121 ;

UPDATE ITEM
SET item_name="Mobile Stand"
WHERE item_id=282;

UPDATE ITEM
SET item_name="Power Bank"
WHERE item_id=343;

UPDATE ITEM
SET item_name="Cricket Bat"
WHERE item_id=404;

UPDATE ITEM
SET item_name="Butcher Knife"
WHERE item_id=525;

-- Adding shipment status
ALTER TABLE SHIPMENT
ADD COLUMN payment VARCHAR(10)
CONSTRAINT check_payment CHECK(payment="done");

UPDATE SHIPMENT
SET payment="done"
WHERE payment IS NULL and whouse_id=1;

UPDATE SHIPMENT
SET payment="done"
WHERE payment IS NULL and whouse_id=5;

UPDATE SHIPMENT
SET payment="done"
WHERE payment IS NULL and whouse_id=2;

UPDATE SHIPMENT
SET payment="done"
WHERE payment IS NULL and whouse_id=4;

UPDATE SHIPMENT
SET payment="pending"
WHERE payment IS NULL and whouse_id=3;

-- Inserting location in warehouse
ALTER TABLE warehouse
ADD COLUMN location VARCHAR(25);

-- Updating ware house
UPDATE warehouse 
SET location="Bapuji Nagar"
WHERE city="Delhi";

-- Deleting location from warehouse
ALTER TABLE warehouse
DROP COLUMN location;

-- ----------------------------------------------------------------------------------
-- Add 3 more tuples in each table

-- 1> list the customers who have letter 'r' in their name
SELECT name
FROM customer
WHERE name LIKE 'r';

-- 2> list all the names of customers and products who have ordered items in the month of october
SELECT C.name,OI.order_amount
FROM customer AS C, order_info AS OI
WHERE C.customer_id = OI.cust_id AND  OI.order_date LIKE '%10%';

-- 3>list the items in descending order of price
SELECT item_name,unit_price
FROM item
ORDER BY unit_price DESC;

-- 4>list the customers who have shopped for 10K or more
SELECT customer_id,name,order_amount
FROM customer,order_info
WHERE customer_id=cust_id AND order_amount>9999
ORDER BY order_amount DESC;

-- 5> how much is the total sales
SELECT SUM(order_amount) AS 'TOTAL SALES '
FROM order_info;

-- 6>How much does an average customer spend on orders
SELECT AVG(order_amount) AS 'Averege Spending'
FROM order_info;

-- 7>List the order_id and order_date ship_date of all orders shipped from warehouses other than Banglore
SELECT O.order_id,O.order_date,S.ship_date,W.city
FROM order_info AS O,shipment AS S,warehouse AS W
WHERE O.order_id=S.ord_id AND S.whouse_id= W.warehouse_id;

-- 8>Select customer who has not done payment
SELECT *
FROM customer
WHERE customer_id IN(
		SELECT cust_id
        FROM order_info
        WHERE order_id NOT IN(
			SELECT ord_id
            FROM shipment
            WHERE payment = 'done'));
            

-- 9> list the name and quantity of items ordered
SELECT I.item_name,OI.quantity
FROM item AS I,order_item AS OI
WHERE I.item_id=OI.itm_id
ORDER BY OI.quantity DESC;

-- 10> List the item and its source and destination addresses
SELECT DISTINCT I.item_name,W.city,C.city
FROM customer AS C,warehouse AS W, item AS I,order_item AS OI
WHERE C.customer_id IN(
	SELECT cust_id
    FROM order_info
    WHERE order_id IN (
		SELECT ord_id
        FROM shipment
        WHERE whouse_id=W.warehouse_id) AND order_id IN(SELECT o_id FROM order_item WHERE itm_id=item_id));
